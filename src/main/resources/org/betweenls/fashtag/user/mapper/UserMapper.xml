<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.betweenls.fashtag.user.mapper.UserMapper">

    <insert id="join" parameterType="UserVO">
        <!-- insert 문 -->
        insert into users (userId, id, password, nickname, username)
        values (seq_users.nextval, #{id}, #{password}, #{nickname}, #{username})

        <!-- Select Key를 이용한 새로운 primary key 값 반환 -->
        <selectKey keyProperty="userId" order="AFTER" resultType="java.lang.Long">
            SELECT seq_users.currval FROM dual
        </selectKey>
    </insert>

    <insert id="setAuth" parameterType="Long">
        insert into auth (userId, auth)
        values (#{userId}, 'ROLE_USER')
    </insert>

    <select id="getUserDetail" parameterType="long" resultType="UserVO">
        SELECT
            u.userId, u.id, u.password, u.profile, u.nickname, u.username, u.createdAt, a.auth
        FROM users u
                 LEFT OUTER JOIN auth a ON u.userId = a.userId
        WHERE u.userId = #{userId}
    </select>

</mapper>