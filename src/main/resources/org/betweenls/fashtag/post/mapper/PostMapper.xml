<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.betweenls.fashtag.post.mapper.PostMapper">

	<select id="getAllPost"
		resultType="org.betweenls.fashtag.post.domain.PostVO"><![CDATA[
		select p.postid,postContent, picture, createdat,updatedat,readcount,userid, nvl((select count(userid)
																						 from likes
																						 where postid = p.postid
																						 group by postid), 0) likeCount
		from posts p
		order by ${order} desc
	]]></select>

	<select id="getHashtagPost"
			resultType="org.betweenls.fashtag.post.domain.PostVO"><![CDATA[
		select p.postid,postContent, picture, createdat,updatedat,readcount,userid, (select count(userid)
																					 from likes
																					 where postid = p.postid
																					 group by postid) likeCount
		from posts p left outer join post_hashtag ph
									 on p.postid = ph.postid left outer join hashtag h
																			 on ph.hashtagId = h.hashtagid
		where hashtag = #{hashtag}
		]]></select>

<!--	<select id="getListWithPaging"-->
<!--		resultType="org.betweenls.fashtag.domain.PostVO">-->
<!--	 <![CDATA[	-->
<!--	 	select -->
<!--	 		bno, title, content, writer, updatedate-->
<!--	 	from-->
<!--	 		(-->
<!--	 			select /*+INDEX_DESC(tbl_board pk_board) */-->
<!--	 				rownum rn, bno, title, content, writer, updatedate-->
<!--	 			from -->
<!--	 				tbl_board-->
<!--	 			where rownum <= #{pageNum} * #{amout})-->
<!--	 	where rn > (#{pageNum} -1) * #{amout}-->
<!--	 ]]>-->
<!--	</select>-->

<!--	<insert id="insert">-->
<!--		insert into tbl_board (bno, title, content, writer)-->
<!--		values (seq_board.nextval, #{title}, #{content}, #{writer})-->
<!--	</insert>-->

<!--	<insert id="insertSelectKey">-->
<!--		<selectKey keyProperty="bno" order="BEFORE"-->
<!--			resultType="long">-->
<!--			select seq_board.nextval from dual-->
<!--		</selectKey>-->
<!--		insert into tbl_board (bno, title, content, writer)-->
<!--		values-->
<!--		(seq_board.nextval, #{title}, #{content}, #{writer})-->
<!--	</insert>-->

<!--	<select id="read"-->
<!--		resultType="org.betweenls.fashtag.domain.PostVO">-->
<!--		SELECT * FROM tbl_board WHERE bno = #{bno}-->
<!--	</select>-->

<!--	<delete id="delete">-->
<!--		delete from tbl_board where bno = #{bno}-->
<!--	</delete>-->

<!--	<update id="update">-->
<!--		update tbl_board-->
<!--		set title=#{title},-->
<!--		content=#{content},-->
<!--		writer=#{writer},-->
<!--		updateDate=sysdate-->
<!--		where bno = #{bno}-->
<!--	</update>-->
</mapper>